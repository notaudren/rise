<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Game</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: black;
        }
        #gameCanvas {
            display: block;
        }
        #loadingContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background: rgba(255, 0, 0, 0.2);
        }
        #loadingBar {
            height: 100%;
            width: 0;
            background: linear-gradient(to right, red, darkred);
            transition: width 0.5s ease;
        }
        #crashHistoryContainer {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            height: 70px;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            padding: 10px 0;
            -ms-overflow-style: none;  /* Internet Explorer 10+ */
            scrollbar-width: none;  /* Firefox */
        }
        #crashHistoryContainer::-webkit-scrollbar { 
            display: none;  /* Safari and Chrome */
        }
        .crashBox {
            display: inline-block;
            width: 60px;
            height: 60px;
            margin: 0 5px;
            line-height: 60px;
            text-align: center;
            color: white;
            font-family: 'Arial', sans-serif;
            font-size: 18px;
            border-radius: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s;
        }
        .crashBox:hover {
            transform: scale(1.1);
        }
        #balanceContainer {
            position: absolute;
            top: 100px;
            left: 10px;
            color: white;
            font-family: 'Arial', sans-serif;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="loadingContainer">
        <div id="loadingBar"></div>
    </div>
    <div id="crashHistoryContainer"></div>
    <div id="balanceContainer">Balance : 100.25$</div>
    <audio id="launchSound" src="decollage.mp3"></audio>
    <audio id="explosionSound" src="explosion.mp3"></audio>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const backgroundImage = new Image();
        backgroundImage.src = 'star-background.jpg';

        const rocketImage = new Image();
        rocketImage.src = 'rocket.png';

        const explosionImage = new Image();
        explosionImage.src = 'explosion.png';

        const launchSound = document.getElementById('launchSound');
        const explosionSound = document.getElementById('explosionSound');
        const loadingBar = document.getElementById('loadingBar');
        const crashHistoryContainer = document.getElementById('crashHistoryContainer');
        const balanceContainer = document.getElementById('balanceContainer');

        let rocket = {
            width: 337.5,
            height: 337.5,
            x: -337.5 / 2,
            y: canvas.height - 337.5, // Adjusted for better positioning
            speed: 4,
            exploded: false
        };

        let backgroundY = 0;
        let multiplier = 1.00;
        let multiplierIncrement = 0.02;
        let gameRunning = true;
        let rocketReachedPosition = false;
        let gameStarted = false;
        const explosionThreshold = 5.0;

        const crashHistory = [];
        let balance = 100.25;

        function drawBackground() {
            ctx.drawImage(backgroundImage, 0, backgroundY, canvas.width, backgroundImage.height);
            ctx.drawImage(backgroundImage, 0, backgroundY - backgroundImage.height, canvas.width, backgroundImage.height);
        }

        function updateBackground() {
            backgroundY += 2;
            if (backgroundY >= backgroundImage.height) {
                backgroundY = 0;
            }
        }

        function drawRocket() {
            if (!rocket.exploded) {
                ctx.drawImage(rocketImage, rocket.x, rocket.y, rocket.width, rocket.height);
            } else {
                ctx.drawImage(explosionImage, rocket.x, rocket.y, rocket.width, rocket.height);
            }
        }

        function drawMultiplier() {
            ctx.font = '120px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = rocket.exploded ? 'red' : 'green';
            ctx.fillText(`x${multiplier.toFixed(2)}`, canvas.width / 2, canvas.height * 7 / 8);
        }

        function updateMultiplier() {
            if (!rocket.exploded && rocketReachedPosition) {
                multiplier += multiplierIncrement;
                checkExplosion();
            }
        }

        function checkExplosion() {
            if (multiplier >= explosionThreshold) {
                rocket.exploded = true;
                gameRunning = false;
                explosionSound.play().catch(error => console.log('Erreur lors de la lecture du son d\'explosion:', error));
                startLoading();
            }
        }

        function updateRocketPosition() {
            if (!rocketReachedPosition) {
                rocket.x += rocket.speed;
                rocket.y -= rocket.speed * (canvas.height / canvas.width);

                const targetX = canvas.width / 2 - rocket.width / 2;
                const targetY = canvas.height / 2 - rocket.height / 2;
                if (rocket.x >= targetX && rocket.y <= targetY) {
                    rocket.x = targetX;
                    rocket.y = targetY;
                    rocketReachedPosition = true;
                }
            }
        }

        function startLoading() {
            let loadingProgress = 0;
            loadingBar.style.width = '0';

            const loadingInterval = setInterval(() => {
                loadingProgress += 2;
                loadingBar.style.width = `${loadingProgress}%`;

                if (loadingProgress >= 100) {
                    clearInterval(loadingInterval);
                    addCrashToHistory(multiplier);
                    resetGame();
                }
            }, 100);
        }

        function addCrashToHistory(multiplier) {
            const crashBox = document.createElement('div');
            crashBox.className = 'crashBox';
            crashBox.textContent = multiplier.toFixed(2);

            if (multiplier < 2) {
                crashBox.style.backgroundColor = 'red';
            } else if (multiplier < 5) {
                crashBox.style.backgroundColor = 'purple';
            } else {
                crashBox.style.backgroundColor = 'green';
            }

            crashHistoryContainer.insertBefore(crashBox, crashHistoryContainer.firstChild);

            if (crashHistoryContainer.childNodes.length > 50) {
                crashHistoryContainer.removeChild(crashHistoryContainer.lastChild);
            }
        }

        function resetGame() {
            rocket = {
                width: 337.5,
                height: 337.5,
                x: -337.5 / 2,
                y: canvas.height - 337.5, // Adjusted for better positioning
                speed: 4,
                exploded: false
            };
            backgroundY = 0;
            multiplier = 1.00;
            rocketReachedPosition = false;
            gameRunning = true;
            gameStarted = false;
            startGame();
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawRocket();
            drawMultiplier();
            updateBackground();
            updateRocketPosition();
            updateMultiplier();

            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            if (!gameStarted) {
                launchSound.play().catch(error => console.log('Erreur lors de la lecture du son de dÃ©collage:', error));
                gameStarted = true;
                gameLoop();
            }
        }

        backgroundImage.onload = function() {
            rocketImage.onload = function() {
                explosionImage.onload = function() {
                    document.addEventListener('click', startGame);
                    document.addEventListener('keydown', (event) => {
                        if (event.key === ' ') {
                            startGame();
                            rocket.exploded = true;
                            gameRunning = false;
                            explosionSound.play().catch(error => console.log('Erreur lors de la lecture du son d\'explosion:', error));
                            startLoading();
                        }
                    });
                };
            };
        };

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            rocket.x = -rocket.width / 2;
            rocket.y = canvas.height - 337.5; // Adjusted for better positioning
        });

        // Allow swipe scrolling on mobile and touch devices
        let startX;
        let scrollLeft;

        crashHistoryContainer.addEventListener('touchstart', (e) => {
            startX = e.touches[0].pageX - crashHistoryContainer.offsetLeft;
            scrollLeft = crashHistoryContainer.scrollLeft;
        });

        crashHistoryContainer.addEventListener('touchmove', (e) => {
            const x = e.touches[0].pageX - crashHistoryContainer.offsetLeft;
            const walk = (x - startX) * 2; // Accelerate the scroll
            crashHistoryContainer.scrollLeft = scrollLeft - walk;
        });
    </script>
</body>
</html>
